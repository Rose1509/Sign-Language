<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lessons - Gesture Lab</title>
    <link rel="stylesheet" href="/static/css/add_lessons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <div class="logo">
                <img src="/static/images/logo_white.png" alt="Logo">
            </div>
            <nav>
                <ul>
                    <li><a href="/dashboard">Dashboard</a></li>
                    <li class="active"><a href="/add_lessons">Lessons</a></li>
                    <li><a href="/add_quizzes">Quizzes</a></li>
                </ul>
            </nav>
            <div class="logout">
                <a href="/logout" onclick="return confirm('Are you sure you want to logout?')"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </div>
        </aside>

        <main class="main-content">
            <header class="dashboard-header">
                <div class="header-text">
                    <h1>Lessons</h1>
                    <p>Manage Your Lessons here</p>
                </div>
                <div class="header-actions">
                    <a href="/admin_profile" class="user-profile-link">
                        <div class="user-profile-icon">
                            <i class="far fa-user-circle"></i>
                        </div>
                    </a>
                </div>
            </header>

            <section class="table-container">
                <table class="lessons-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Level</th>
                            <th>Name</th>
                            <th>Image</th>
                            <th>Heading</th>
                            <th>Description</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if lessons %}
                            {% for lesson in lessons %}
                            <tr>
                                <td>{{ lesson.id }}</td>
                                <td>{{ lesson.sign_level }}</td>
                                <td>{{ lesson.name }}</td>
                                <td><img src="{{ lesson.image }}" alt="{{ lesson.name }}" class="sign-img" style="max-width: 100px; max-height: 100px;"></td>
                                <td>{{ lesson.heading }}</td>
                                <td class="description-cell">{{ lesson.description[:100] }}{% if lesson.description|length > 100 %}...{% endif %}</td>
                                <td>
                                    <button class="edit-btn" 
                                            data-id="{{ lesson.id }}"
                                            data-level="{{ lesson.sign_level }}"
                                            data-name="{{ lesson.name }}"
                                            data-image="{{ lesson.image }}"
                                            data-heading="{{ lesson.heading }}"
                                            data-description="{{ lesson.description|replace('"', '&quot;')|replace("'", "&#39;") }}">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <form method="post" action="/delete_lesson" style="display: inline;">
                                        <input type="hidden" name="lesson_id" value="{{ lesson.id }}">
                                        <button type="submit" class="delete-btn" onclick="return confirm('Are you sure you want to delete this lesson?')">
                                            <i class="fas fa-trash delete-icon"></i>
                                        </button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="7" style="text-align: center;">No lessons found. Add your first lesson below!</td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </section>

            <section class="add-section-card">
                <h2 class="section-title">Add new signs</h2>
                <form method="post" action="/add_lessons" id="lessonForm" enctype="multipart/form-data">
                    <input type="hidden" name="lesson_id" id="lesson_id" value="">
                    <div class="form-grid">
                        <div class="input-group">
                            <label>Sign Level</label>
                            <select name="sign_level" id="sign_level" required>
                                <option value="">Select Level</option>
                                <option value="Basic">Basic</option>
                                <option value="Intermediate">Intermediate</option>
                                <option value="Advance">Advance</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Name</label>
                            <input type="text" name="name" id="name" required>
                        </div>
                        <div class="input-group">
                            <label>Image</label>
                            <input type="file" name="image" id="image" accept="image/*" required>
                            <small style="display: block; margin-top: 5px; color: #666;">Choose an image file (JPG, PNG, GIF, etc.)</small>
                            <div id="imagePreview" style="margin-top: 10px; display: none;">
                                <img id="previewImg" src="" alt="Preview" style="max-width: 200px; max-height: 200px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <input type="hidden" name="existing_image" id="existing_image" value="">
                        </div>
                        <div class="input-group">
                            <label>Heading</label>
                            <input type="text" name="heading" id="heading" required>
                        </div>
                        <div class="input-group description-input">
                            <label>Description</label>
                            <textarea name="description" id="description" rows="5" required></textarea>
                        </div>
                        <div class="form-buttons">
                            <button type="submit" class="btn-dark" id="submitBtn">Add Lessons</button>
                            <button type="button" class="btn-dark" onclick="clearForm()">Clear Form</button>
                        </div>
                    </div>
                </form>
            </section>

            <script>
                // Add event listeners to all edit buttons
                document.addEventListener('DOMContentLoaded', function() {
                    const editButtons = document.querySelectorAll('.edit-btn');
                    editButtons.forEach(button => {
                        button.addEventListener('click', function() {
                            editLesson(
                                this.getAttribute('data-id'),
                                this.getAttribute('data-level'),
                                this.getAttribute('data-name'),
                                this.getAttribute('data-image'),
                                this.getAttribute('data-heading'),
                                this.getAttribute('data-description')
                            );
                        });
                    });
                });
                
                // Image preview functionality
                document.getElementById('image').addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            document.getElementById('previewImg').src = e.target.result;
                            document.getElementById('imagePreview').style.display = 'block';
                        };
                        reader.readAsDataURL(file);
                    } else {
                        document.getElementById('imagePreview').style.display = 'none';
                    }
                });
                
                function editLesson(id, signLevel, name, image, heading, description) {
                    document.getElementById('lesson_id').value = id;
                    document.getElementById('sign_level').value = signLevel;
                    document.getElementById('name').value = name;
                    document.getElementById('existing_image').value = image;
                    document.getElementById('heading').value = heading;
                    document.getElementById('description').value = description;
                    
                    // Show existing image preview
                    if (image) {
                        document.getElementById('previewImg').src = image;
                        document.getElementById('imagePreview').style.display = 'block';
                    }
                    
                    // Make image field optional for updates (user can keep existing or upload new)
                    document.getElementById('image').required = false;
                    
                    // Change form action and button text
                    document.getElementById('lessonForm').action = '/update_lesson';
                    document.getElementById('submitBtn').textContent = 'Update Lessons';
                    
                    // Scroll to form
                    document.querySelector('.add-section-card').scrollIntoView({ behavior: 'smooth' });
                }
                
                function clearForm() {
                    document.getElementById('lessonForm').reset();
                    document.getElementById('lesson_id').value = '';
                    document.getElementById('existing_image').value = '';
                    document.getElementById('imagePreview').style.display = 'none';
                    document.getElementById('image').required = true;
                    document.getElementById('lessonForm').action = '/add_lessons';
                    document.getElementById('submitBtn').textContent = 'Add Lessons';
                }
            </script>

            <footer class="main-footer">
                <p>&copy; 2025 GestureLab. All rights reserved.</p>
            </footer>
        </main>
    </div>
</body>
</html>